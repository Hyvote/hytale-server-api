<VirtualHost *:80>
    # Server configuration
    ServerName your-domain.com
    ServerAlias www.your-domain.com

    # Document root - point to your API directory
    DocumentRoot /var/www/hytale-api

    # Directory configuration
    <Directory /var/www/hytale-api>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted

        # Enable rewrite engine
        RewriteEngine On

        # Redirect all requests to index.php
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule ^(.*)$ index.php [QSA,L]
    </Directory>

    # Deny access to sensitive files
    <FilesMatch "^(config\.php|\.env|\.git.*|composer\.(json|lock))$">
        Require all denied
    </FilesMatch>

    # Deny access to lib directory
    <Directory /var/www/hytale-api/lib>
        Require all denied
    </Directory>

    # Deny access to cache directory
    <Directory /var/www/hytale-api/cache>
        Require all denied
    </Directory>

    # PHP settings
    <IfModule mod_php.c>
        php_flag display_errors Off
        php_flag log_errors On
        php_value error_log /var/log/apache2/hytale-api-error.log
    </IfModule>

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/hytale-api-error.log
    CustomLog ${APACHE_LOG_DIR}/hytale-api-access.log combined

    # Security headers
    <IfModule mod_headers.c>
        Header set X-Content-Type-Options "nosniff"
        Header set X-Frame-Options "DENY"
        Header set X-XSS-Protection "1; mode=block"
    </IfModule>
</VirtualHost>

# Optional: HTTPS configuration (recommended for production)
# <VirtualHost *:443>
#     ServerName your-domain.com
#     ServerAlias www.your-domain.com
#
#     DocumentRoot /var/www/hytale-api
#
#     SSLEngine on
#     SSLCertificateFile /etc/ssl/certs/your-cert.crt
#     SSLCertificateKeyFile /etc/ssl/private/your-key.key
#
#     # Include all the same Directory and security settings from above
# </VirtualHost>
